{
"Dhcp4": {
    "interfaces-config": {
        "interfaces": ["{{ kea_interface }}"],
        "dhcp-socket-type": "raw"
    },
    "control-socket": {
        "socket-type": "unix",
        "socket-name": "/run/kea/kea4-ctrl-socket"
    },
    "lease-database": {
        "type": "memfile",
        "lfc-interval": 3600
    },
    "expired-leases-processing": {
        "reclaim-timer-wait-time": 10,
        "flush-reclaimed-timer-wait-time": 25,
        "hold-reclaimed-time": 3600,
        "max-reclaim-leases": 100,
        "max-reclaim-time": 250,
        "unwarned-reclaim-cycles": 5
    },
    "valid-lifetime": 4000,
    "renew-timer": 1000,
    "rebind-timer": 2000,

    "hooks-libraries": [
        {
            "library": "/usr/lib/x86_64-linux-gnu/kea/hooks/libdhcp_ha.so",
            "parameters": {
                "high-availability": [
                    {
                        "this-server-name": "{{ inventory_hostname }}",
                        "mode": "hot-standby",
                        "heartbeat-delay": 10,
                        "max-response-delay": 60,
                        "max-ack-delay": 10,
                        "max-unacked-clients": 0,
                        "peers": [
                            {
                                "name": "dhcp-01",
                                "url": "http://{{ primary_ip }}:{{ ha_port }}/",
                                "role": "primary",
                                "auto-failover": true
                            },
                            {
                                "name": "dhcp-02",
                                "url": "http://{{ secondary_ip }}:{{ ha_port }}/",
                                "role": "standby",
                                "auto-failover": true
                            }
                        ]
                    }
                ]
            }
        }
    ],

    "subnet4": [
        {% for net in dhcp_subnets %}
        {
            "id": {{ net.id }},
            "subnet": "{{ net.subnet }}",
            "option-data": [
                {
                    "name": "routers",
                    "data": "{{ net.router }}"
                },
                {
                    "name": "domain-name-servers",
                    "data": "{{ dns_servers | join(', ') }}"
                },
                {
                    "name": "domain-name",
                    "data": "{{ domain_name }}"
                }
            ],
            "pools": [
                {
                    "pool": "{{ net.pool_start }} - {{ net.pool_end }}"
                }
            ]
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ],

    "loggers": [
    {
        "name": "kea-dhcp4",
        "output_options": [
            {
                "output": "stdout",
                "pattern": "%-5p %m\n"
            }
        ],
        "severity": "INFO",
        "debuglevel": 0
    }
  ]
}
}